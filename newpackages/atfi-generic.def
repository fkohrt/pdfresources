%%
%% This is file `atfi-pdftex.def',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% attachfile2.dtx  (with options: `pdftex')
%%
%% This is a generated file.
%%
%% Project: attachfile2
%% Version: 2019/11/26 v2.11
%%
%% Copyright (C)
%%    2005-2010, 2012  Heiko Oberdiek
%%    2016-2019  Oberdiek Package Support Group
%%
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either
%% version 1.3c of this license or (at your option) any later
%% version. This version of this license is in
%%    https://www.latex-project.org/lppl/lppl-1-3c.txt
%% and the latest version of this license is in
%%    https://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of
%% LaTeX version 2005/12/01 or later.
%%
%% This work has the LPPL maintenance status "maintained".
%%
%% The Current Maintainers of this work are
%% Heiko Oberdiek and the Oberdiek Package Support Group
%% https://github.com/ho-tex/attachfile2/issues
%%
%%
%% This work consists of the main source file attachfile2.dtx
%% and the derived files
%%    attachfile2.sty, attachfile2.pdf,
%%    atfi-dvips.def, atfi-pdftex.def, atfi-dvipdfmx.def, atfi-luatex.def
%%    pdfatfi.pl, pdfatfi.1.
%%
\NeedsTeXFormat{LaTeX2e}
\ProvidesFile{atfi-generic.def}%
  [2020/04/13 v1.0 generic attachfile2 (UF)]%

\define@key{AtFi@file}{Size}{%
  \edef\atfi@params{\atfi@params/Size #1}%
}
\ExplSyntaxOn
\def\atfi@embedfile#1
  {%
  \pdfobject_if_exist:nF { atfi@fileobj@#1 }
   {
     %keys for dict entries ...
     \pdffile_embed:nn { atfi@fileobj@#1 }{ #1 }
   }
  }

% we probably need an xform by icon ...

\def\atfi@xform{%
  \pdf_xform_new:nnn
  { atfi@appearancebox }
  { }
  { \usebox\atfi@appearancebox }
  %\immediate\pdfxform\atfi@appearancebox
  %\edef\atfi@appearanceobj{\the\pdflastxform}%
}
\ExplSyntaxOff

\let\atfi@xform@icon\atfi@xform
\def\atfi@refxform#1{%
  \pdfrefxform#1\relax
}
\ExplSyntaxOn
\def\atfi@insert@file@annot#1{%
  \rule{0pt}{0pt}%
  \ifatfi@appearance
    \edef\atfi@appearance@dict{%
      /AP<<%
        /N~ \pdf_xform_ref:n { atfi@appearancebox }%
        /R~ \pdf_xform_ref:n { atfi@appearancebox }%
        /D~ \pdf_xform_ref:n { atfi@appearancebox }%
      >>%
    }%
  \else
    \let\atfi@appearance@dict\ltx@empty
  \fi
%  \ltx@IfUndefined{atfi@fsobj@#1}{%
%    \begingroup
%      \hypersetup{unicode=false}%
%      \atfi@pdfstringdef\atfi@file{#1}%
%      \pdf_object_now:nx{dict}{%
%          /Type/Filespec%
%          /F(\atfi@file)%
%          \ifx\atfi@ucfilespec\ltx@empty
%          \else
%            /UF(\atfi@ucfilespec)%
%          \fi
%          /EF<<%
%            /F~ \@nameuse{atfi@fileobj@#1}%
%          >>%
%      }%
%      \expandafter\xdef\csname atfi@fsobj@#1\endcsname{%
%        \pdf_object_last:
%      }%
%    \endgroup
%  }{%
%  }%
  \pdfannot_box:nnnn
     {\atfi@scale\atfi@appearancewidth}
     {\atfi@scale\atfi@appearanceheight}
     {\atfi@scale\atfi@appearancedepth}
     {
      /Subtype/FileAttachment%
      \atfi@icon
      \atfi@color@annot
      \atfi@author
      \atfi@date
      \atfi@annotname
      \atfi@description
      \atfi@subject
      \atfi@appearance@dict
      /F~ \theatfi@flags
      /FS~ \pdf_object_ref:n{atfi@fileobj@#1}%
     }%
  %\rule{0pt}{\atfi@appearanceheight}%
%  \rule[-\atfi@appearancedepth]{0pt}{\atfi@appearancedepth}%
%  \rule{\atfi@appearancewidth}{0pt}%
}
\ExplSyntaxOff
\endinput
%%
%% End of file `atfi-pdftex.def'.
