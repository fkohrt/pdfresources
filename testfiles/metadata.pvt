\input{regression-test}
\documentclass{article}
\PassOptionsToPackage{debug}{pdfresources}
\usepackage{pdfresources}

\ExplSyntaxOn
\driver_pdf_compresslevel:n {0}
\driver_pdf_compress_objects:n {0}
%\pdf_version_gset:n{1.7}
\ExplSyntaxOff
\usepackage{hyperxmp,lipsum}

\usepackage[customdriver=hluatex-experimental,
   ocgcolorlinks,
   pdftoolbar=false,
   pdfauthor={Ulrike Fischer},
   pdftitle={A test of metadata},
   pdfnonfullscreenpagemode=UseNone,
   pdfnumcopies=4,
   pdfpagelayout=SinglePage]
   {hyperref}

\ExplSyntaxOn
\driver_pdf_object_new:nn{metadata-obj}{stream}
\pdf_catalog_gput:nn{Metadata}{\driver_pdf_object_ref:n{metadata-obj}}
\ExplSyntaxOff

 \begin{document}
 blblb \lipsum
 \ExplSyntaxOn\makeatletter
 \hyxmp@find@metadata
 \hyxmp@construct@packet
 \exp_args:Nnx\driver_pdf_object_write:nn{metadata-obj}{{/Type~/Metadata~/Subtype~/XML}{\hyxmp@xml}}%
\ExplSyntaxOff
\end{document}
